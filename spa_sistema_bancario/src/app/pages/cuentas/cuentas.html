<div *ngIf="error()" class="alert alert--error">
  <span class="alert__icon"><i class="material-icons">warning</i></span>
  <span class="alert__message">{{ error() }}</span>
  <button class="alert__close" (click)="clearMessages()"><i class="material-icons">close</i></button>
</div>

<div *ngIf="successMessage()" class="alert alert--success">
  <span class="alert__icon"><i class="material-icons">check_circle</i></span>
  <span class="alert__message">{{ successMessage() }}</span>
  <button class="alert__close" (click)="clearMessages()"><i class="material-icons">close</i></button>
</div>

<section class="card">
  <div class="card__header">
    <div class="card__actions">
      <div class="search-controls">
        <input
          type="text"
          [ngModel]="searchTerm()"
          (ngModelChange)="onSearchChange($event)"
          class="search__input"
          placeholder="Buscar por número, cliente o tipo..."
          [disabled]="isLoading()"
        />
        <button 
          *ngIf="searchTerm()" 
          class="search__clear"
          (click)="clearSearch()"
          title="Limpiar búsqueda"
        >
          <i class="material-icons">close</i>
        </button>
      </div>
      <button 
        class="btn btn--primary"
        (click)="openCreateModal()"
        [disabled]="isLoading()"
      >
        <i class="material-icons">add</i>
        Agregar Cuenta
      </button>
    </div>
  </div>

  <div *ngIf="isLoading()" class="loading">
    <div class="loading__spinner"></div>
    <span>Cargando cuentas...</span>
  </div>

  <div *ngIf="!isLoading()" class="table-container enhanced-table">
    <table class="data-table" *ngIf="filteredCuentas().length > 0">
      <thead class="data-table__header">
        <tr>
          <th>Número de Cuenta</th>
          <th>Cliente</th>
          <th>Tipo</th>
          <th>Saldo</th>
          <th>Estado</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody class="data-table__body">
        <tr *ngFor="let cuenta of filteredCuentas(); trackBy: trackByCuentaId">
          <td class="font-semibold">{{ cuenta.numeroCuenta}}</td>
          <td>{{ cuenta.clienteIdentificacion || 'N/A' }}</td>
          <td>{{ cuenta.tipoCuenta }}</td>
          <td class="text-right font-semibold">{{ cuenta.saldoInicial | currency:'USD':'symbol':'1.2-2' }}</td>
          <td>
            <span 
              class="badge" 
              [ngClass]="getEstadoBadgeClass(cuenta)">
              {{ getEstadoText(cuenta) }}
            </span>
          </td>
          <td>
            <div class="table-actions">
              <button 
                class="action-btn action-btn--edit" 
                title="Editar cuenta"
                (click)="openEditModal(cuenta)"
                [disabled]="isLoading()"
              >
                <i class="material-icons">edit</i>
              </button>
              <button 
                class="action-btn action-btn--delete" 
                title="Eliminar cuenta"
                (click)="openDeleteModal(cuenta)"
                [disabled]="isLoading()"
              >
                <i class="material-icons">delete</i>
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>

    <div class="empty-state" *ngIf="filteredCuentas().length === 0 && !isLoading()">
      <div class="empty-state__icon"><i class="material-icons">credit_card</i></div>
      <div class="empty-state__title">
        {{ searchTerm() ? 'No se encontraron cuentas' : 'No hay cuentas registradas' }}
      </div>
      <div class="empty-state__description">
        {{ searchTerm() ? 'Intenta con otros términos de búsqueda' : 'Comienza creando tu primera cuenta' }}
      </div>
    </div>
  </div>
</section>

<!-- Modal para crear cuenta -->
<app-modal
  [isOpen]="isCreateModalOpen()"
  [config]="createModalConfig"
  (close)="closeCreateModal()"
>
  <app-cuenta-form
    #createCuentaForm
    [cuenta]="null"
    [isEditMode]="false"
    (formSubmit)="onCreateCuenta($event)"
    (formCancel)="closeCreateModal()"
  ></app-cuenta-form>
</app-modal>

<!-- Modal para editar cuenta -->
<app-modal
  [isOpen]="isEditModalOpen()"
  [config]="editModalConfig"
  (close)="closeEditModal()"
>
  <app-cuenta-form
    #editCuentaForm
    [cuenta]="selectedCuenta()"
    [isEditMode]="true"
    (formSubmit)="onEditCuenta($event)"
    (formCancel)="closeEditModal()"
  ></app-cuenta-form>
</app-modal>

<!-- Modal para confirmar eliminación -->
<app-modal
  [isOpen]="isDeleteModalOpen()"
  [config]="deleteModalConfig"
  (close)="closeDeleteModal()"
>
  <div class="delete-confirmation">
    <div class="delete-confirmation__icon"><i class="material-icons">warning</i></div>
    <div class="delete-confirmation__content">
      <p class="delete-confirmation__text">
        ¿Eliminar cuenta?
      </p>
    </div>
  </div>
  <div slot="footer" class="modal__footer-buttons">
    <button class="btn btn--outline" (click)="closeDeleteModal()">Cancelar</button>
    <button class="btn btn--primary delete-btn" (click)="confirmDelete()">Eliminar</button>
  </div>
</app-modal>
